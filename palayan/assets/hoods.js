"use strict";function process_hoods(map_div,map,map_bnds){var poly_opts={strokeColor:'#333333',strokeOpacity:0.3,strokeWeight:1,fillOpacity:0.6},poly;var bubble=document.querySelector('.map-bubble');var map_bnds=new google.maps.LatLngBounds();var hn,pn,n,tout,ll,uri,shape,hood_bnds;for(hn=0;hn<hoods.length;hn++){poly_opts.paths=[];hood_bnds=new google.maps.LatLngBounds();for(pn=0;pn<hoods[hn][5].length;pn++){var pts=hoods[hn][5][pn].split(' ');shape=[];for(n=0;n<pts.length;n+=2){ll=new google.maps.LatLng(parseInt(pts[n],36)/1e4-90,parseInt(pts[n+1],36)/1e4-180);hood_bnds.extend(ll);shape.push(ll);}
poly_opts.paths.push(shape);}
map_bnds.union(hood_bnds);poly_opts.fillColor=hoods[hn][3];poly=new google.maps.Polygon(poly_opts);poly.setMap(map);uri=hoods[hn][1]+'-'+hoods[hn][0]+'/'+hoods[hn][2]+'/livability';poly.opts={position:{lat:hood_bnds.getCenter().lat(),lng:hood_bnds.getNorthEast().lng()},content:'<a class="x" href="/'+uri.enc()+'/"><b>'+hoods[hn][2]+'</a>',uri:'/'+uri.enc()+'/'};google.maps.event.addListener(poly,'click',function(){window.location.href=this.opts.uri;});google.maps.event.addListener(poly,'mouseover',function(){clearTimeout(tout);var ll=map.proj.fromLatLngToContainerPixel(new google.maps.LatLng(this.opts.position));bubble.innerHTML=this.opts.content;bubble.style.left=Math.round(map_div.offsetLeft+ll.x+2)+'px';bubble.style.top=Math.round(map_div.offsetTop+ll.y-bubble.offsetHeight/2)+'px';bubble.removeAttribute('data-hide');this.setOptions({strokeOpacity:1,strokeWeight:1.5,zIndex:2});});google.maps.event.addListener(poly,'mouseout',function(){tout=setTimeout(function(){bubble.setAttribute('data-hide','');},1500);this.setOptions({strokeOpacity:0.3,strokeWeight:1,zIndex:1});});}
return map_bnds;}
function setup_hood_map(){var map_div=document.getElementById('map-hoods');if(map_div.offsetParent===null){var elm=map_div.parentElement.parentElement;elm.parentElement.removeChild(elm);return;}
var hoods=window.hoods||[];if(!hoods.length){var elm=map_div.parentElement.parentElement;elm.parentElement.removeChild(elm);return;}
var map=(function(){var opts={mapTypeId:google.maps.MapTypeId.ROADMAP};var map=new google.maps.Map(map_div,opts);var overlay=new google.maps.OverlayView();overlay.draw=function(){};overlay.onAdd=function(){map.proj=this.getProjection();};overlay.setMap(map);return map;})();var map_bnds=process_hoods(map_div,map);if(!map_bnds.isEmpty()){map.fitBounds(map_bnds);}}
function setup_quicksearch(){var frm=document.getElementById('quick-hood');if(frm){var qry=frm.querySelector('input');var lst=frm.querySelector('ul');var lis=document.querySelectorAll('#all-hoods li');var src=(function(){var data_view=[];var observer=function(){};var length=function(){return data_view.length;};var rows=function(){return data_view;};var row=function(n){return data_view[n];};var attach=function(fnc){observer=fnc;};var query=function(q){var i=0,l=lis.length,arr=[];for(;i<l;i++){var o={txt:lis[i].children[0].textContent,uri:lis[i].children[0].href};if(o.txt.toLowerCase().lastIndexOf(q.toLowerCase(),0)===0){arr.push(o);}}
data_view=arr;observer();};return{attach:attach,query:query,length:length,rows:rows,row:row};})();var mac=autocomplete(qry,lst,src,function fmt(itm){return itm.txt;},function sel(n){var obj=src.row(n);window.location.href=obj.uri;});}}
doc_ready(function(){var w4md=function(){if(window.hoods&&window.hoods.constructor===Array){setup_hood_map();document.querySelector('a.hood-attrib').style.display='block';return;}
setTimeout(w4md,50);};w4md();setup_quicksearch();var use_trans=document.querySelector('.use-transpose');if(use_trans){var lsts=document.querySelectorAll('ul.stacked-place-list');var n=window.getComputedStyle(use_trans).getPropertyValue('z-index');n=parseInt(n,10);columnize(lsts[0],n);columnize(lsts[1],n);columnize(lsts[2],n);}});