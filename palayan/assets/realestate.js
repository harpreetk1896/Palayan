
function mortgage_calc_ui(con,fnc_notify){var homeprice=con.querySelector('form input[name=mort-calc-homeprice]');var downpayment=con.querySelector('form input[name=mort-calc-downpayment]');var downpayment_pct=con.querySelector('form input[name=mort-calc-downpayment-pct]');var interest=con.querySelector('form input[name=mort-calc-interest]');var loanterm=con.querySelector('form input[name=mort-calc-loanterm]');var proptax=con.querySelector('form input[name=mort-calc-proptax]');var proptax_pct=con.querySelector('form input[name=mort-calc-proptax-pct]');var homeins=con.querySelector('form input[name=mort-calc-homeins]');var hoadues=con.querySelector('form input[name=mort-calc-hoadues]');downpayment.addEventListener('keyup',function(evt){downpayment_pct.value='';});downpayment_pct.addEventListener('keyup',function(evt){downpayment.value='';});proptax.addEventListener('keyup',function(evt){proptax_pct.value='';});proptax_pct.addEventListener('keyup',function(evt){proptax.value='';});var onfocus=function(evt){if(evt.target.nodeName.toLowerCase()=='input'){if(evt.target.value){var dec=parseInt(evt.target.getAttribute('data-dec'),10)||0;var val=evt.target.value.replace(/[^.0123456789]/g,'');if(val&&dec){var mul=Math.pow(10,dec);val=Math.round(parseFloat(val)*mul)/mul;evt.target.value=val;}
else if(val){evt.target.value=val;}
else{evt.target.value='';}}}};var onblur=function(evt){if(evt.target.nodeName.toLowerCase()=='input'){if(evt.target.value){var dec=parseInt(evt.target.getAttribute('data-dec'),10)||0;var val=evt.target.value.replace(/[^.0123456789]/g,'');if(val&&dec){var mul=Math.pow(10,dec);val=Math.round(parseFloat(val)*mul)/mul;evt.target.value=val;}
else if(val){evt.target.value=commas(val);}
else{evt.target.value='';}}}};var inps=[].slice.call(con.querySelectorAll('form input'));inps.forEach(function(elm,ndx,arr){elm.addEventListener('focus',onfocus);elm.addEventListener('blur',onblur);});con.querySelector('form').addEventListener('submit',function(evt){fnc_notify(evt.target.elements);evt.preventDefault();});}
function mortgage_calc_model(elms,data){var price=parseInt(elms['mort-calc-homeprice'].value.replace(/[^.0123456789]/g,''),10);if(!price){return false;}
var down_pct=0;var down=elms['mort-calc-downpayment'].value.replace(/[^.0123456789]/g,'');if(!down){down=parseFloat(elms['mort-calc-downpayment-pct'].value.replace(/[^.0123456789]/g,''))/100;down_pct=down;down=Math.round(price*down);}
else{down=parseInt(down,10)||0;down_pct=Math.round(down/price*1000)/1000;}
var principal=price-down;var int_rate=parseFloat(elms['mort-calc-interest'].value.replace(/[^.0123456789]/g,''))/100/12;var mtg_term=parseInt(elms['mort-calc-loanterm'].value.replace(/[^.0123456789]/g,''),10)*12;var t=1-Math.pow(1+int_rate,-mtg_term);t=principal*int_rate/t;t=Math.ceil(t);data['mort-calc-pmt']=t;down_pct*=100;var pmi=0;if(down_pct>=20)pmi=0;else if(down_pct>=15)pmi=0.0045;else if(down_pct>=10)pmi=0.006;else if(down_pct>=5)pmi=0.0075;else pmi=0.0095;pmi*=principal;data['mort-calc-pmi']=Math.ceil(pmi/12);var proptax=elms['mort-calc-proptax'].value.replace(/[^.0123456789]/g,'')||0;if(!proptax){proptax=parseFloat(elms['mort-calc-proptax-pct'].value.replace(/[^.0123456789]/g,'')||0)/100;proptax=Math.round(price*proptax);}
else{proptax=parseInt(proptax,10);}
data['mort-calc-tax']=Math.ceil(proptax/12);data['mort-calc-ins']=Math.ceil(parseInt(elms['mort-calc-homeins'].value.replace(/[^.0123456789]/g,'')||0,10)/12);data['mort-calc-hoa']=Math.ceil(parseInt(elms['mort-calc-hoadues'].value.replace(/[^.0123456789]/g,'')||0,10)/12);data['mort-calc-tot']=data['mort-calc-pmt']+data['mort-calc-pmi']+data['mort-calc-tax']+data['mort-calc-ins']+data['mort-calc-hoa'];}
function mortgage_calc(con){var data={'mort-calc-tot':2332,'mort-calc-pmt':1668,'mort-calc-pmi':180,'mort-calc-tax':400,'mort-calc-ins':84,'mort-calc-hoa':0};var render=function(){var blks=con.querySelectorAll('.stackable-graph-blocks i');var lis=con.querySelectorAll('.stackable-graph-legend li');var i,tot=data['mort-calc-tot'];var acc_w=0,w;for(i=0;i<blks.length;i++){var dat=data[blks[i].className];w=Math.round(dat/tot*100);acc_w+=w;blks[i].style.width=w+'%';var str=lis[i].innerHTML.split('<br>')[0];lis[i].innerHTML=str+'<br>$'+commas(dat);}
if(acc_w>196){dat=data[blks[1].className];w=Math.round(dat/tot*100);w+=200-acc_w;blks[1].style.width=w+'%';}
lis[0].style.display='none';con.querySelector('figcaption b').textContent='$'+commas(tot);blks[0].innerHTML=' $'+commas(tot);};mortgage_calc_ui(con,function(elms){mortgage_calc_model(elms,data);render();});render();}
function afford_calc_ui(con,fnc_notify){var income=con.querySelector('form input[name=afford-calc-income]');var downpayment=con.querySelector('form input[name=afford-calc-downpayment]');var mondebt=con.querySelector('form input[name=afford-calc-mondebt]');var interest=con.querySelector('form input[name=afford-calc-interest]');var loanterm=con.querySelector('form input[name=afford-calc-loanterm]');var proptax=con.querySelector('form input[name=afford-calc-proptax]');var homeins=con.querySelector('form input[name=afford-calc-homeins]');var hoadues=con.querySelector('form input[name=afford-calc-hoadues]');var dtival=con.querySelector('form input[name=afford-calc-dti-value]');var dti=con.querySelector('input[name=afford-calc-dti]');var form=con.querySelector('form');var onfocus=function(evt){if(evt.target.nodeName.toLowerCase()=='input'){if(evt.target.value){var dec=parseInt(evt.target.getAttribute('data-dec'),10)||0;var val=evt.target.value.replace(/[^.0123456789]/g,'');if(val&&dec){var mul=Math.pow(10,dec);val=Math.round(parseFloat(val)*mul)/mul;evt.target.value=val;}
else if(val){evt.target.value=val;}
else{evt.target.value='';}}}};var onblur=function(evt){if(evt.target.nodeName.toLowerCase()=='input'){if(evt.target.value){var dec=parseInt(evt.target.getAttribute('data-dec'),10)||0;var val=evt.target.value.replace(/[^.0123456789]/g,'');if(val&&dec){var mul=Math.pow(10,dec);val=Math.round(parseFloat(val)*mul)/mul;evt.target.value=val;}
else if(val){evt.target.value=commas(val);}
else{evt.target.value='';}}}};var inps=[].slice.call(con.querySelectorAll('form input'));inps.forEach(function(elm,ndx,arr){elm.addEventListener('focus',onfocus);elm.addEventListener('blur',onblur);});dti.addEventListener('input',function(evt){dtival.value=dti.value;fnc_notify(form.elements);});form.addEventListener('submit',function(evt){fnc_notify(evt.target.elements);evt.preventDefault();});fnc_notify(form.elements);}
function afford_calc(con){var data={'afford-calc-mon-inc':0,'afford-calc-mort-pay':0,'afford-calc-debt-pay':0,'afford-calc-inc-tax':0,'afford-calc-remain':0,'afford-calc-dti':0,'afford-calc-afford':0};var render=function(){var blks=con.querySelectorAll('.stackable-graph-blocks i');var lis=con.querySelectorAll('.stackable-graph-legend li');var i,tot=data['afford-calc-mon-inc'];var acc_w=0,w;for(i=0;i<blks.length;i++){var dat=data[blks[i].className];w=Math.round(dat/tot*100);acc_w+=w;blks[i].style.width=w+'%';var str=lis[i].innerHTML.split('<br>')[0];lis[i].innerHTML=str+'<br>$'+commas(dat);}
if(acc_w>196){w+=200-acc_w;blks[i-1].style.width=w+'%';}
con.querySelector('.dti-input-labels').textContent=data['afford-calc-dti']+'%';lis[0].style.display='none';con.querySelector('figcaption b').textContent='$'+commas(data['afford-calc-afford']);blks[0].innerHTML=' $'+commas(tot);};afford_calc_ui(con,function(elms){afford_calc_model(elms,data);render();});}
function afford_calc_model(elms,data){var est_taxes=function(annual_inc){var prev_owe=[120529.75,119934.75,46278.75,18558.75,5183.75,927.50,0.00];var tax_rate=[0.396,0.35,0.33,0.28,0.25,0.15,0.10];var break_pt=[415051,413351,190151,91151,37651,9276,0];var tax=0,n=7,i;for(i=0;i<n;i++){if(break_pt[i]<=annual_inc){tax=(annual_inc-break_pt[i])*tax_rate[i]+prev_owe[i];tax=Math.round(tax);break;}}
return tax;};var income=parseInt(elms['afford-calc-income'].value.replace(/[^.0123456789]/g,''),10)||65000;var downpayment=parseInt(elms['afford-calc-downpayment'].value.replace(/[^.0123456789]/g,''),10)||25000;var mon_debt=parseInt(elms['afford-calc-debt'].value.replace(/[^.0123456789]/g,''),10)||0;var interest=parseFloat(elms['afford-calc-interest'].value.replace(/[^.0123456789]/g,''))/100||3.75;var loanterm=parseInt(elms['afford-calc-loanterm'].value.replace(/[^.0123456789]/g,''),10)||30;var proptax=parseInt(elms['afford-calc-proptax'].value.replace(/[^.0123456789]/g,''),10)||0;var homeins=parseInt(elms['afford-calc-homeins'].value.replace(/[^.0123456789]/g,''),10)||0;var hoadues=parseInt(elms['afford-calc-hoadues'].value.replace(/[^.0123456789]/g,''),10)||0;var dti_pct=parseInt(elms['afford-calc-dti-value'].value.replace(/[^.0123456789]/g,''),10)||0;var dti=dti_pct/100;var int_mul=(interest/12)/(1-Math.pow(1+(interest/12),-(loanterm*12)));var mon_inc=income/12;var mon_pmt=mon_inc*dti;var princ=(mon_pmt-mon_debt)/int_mul;var afford=princ+downpayment;var hoa=hoadues/12/int_mul;var ins=homeins/12/int_mul;var tax=proptax/12/int_mul;afford-=hoa;afford-=ins;afford-=tax;if(elms['afford-calc-use-pmi'].checked){var down_pct=Math.ceil(downpayment/afford*100);var pmi=0;if(down_pct>=20)pmi=0;else if(down_pct>=15)pmi=0.0045;else if(down_pct>=10)pmi=0.006;else if(down_pct>=5)pmi=0.0075;else pmi=0.0095;afford-=(princ*pmi/12/int_mul);}
var mon_inctax=est_taxes(income)/12;data['afford-calc-mon-inc']=Math.round(mon_inc);data['afford-calc-mort-pay']=Math.round(mon_pmt);data['afford-calc-debt-pay']=Math.round(mon_debt);data['afford-calc-inc-tax']=Math.round(mon_inctax);data['afford-calc-remain']=data['afford-calc-mon-inc'];data['afford-calc-remain']-=data['afford-calc-mort-pay']+data['afford-calc-debt-pay']+data['afford-calc-inc-tax'];data['afford-calc-dti']=dti_pct;data['afford-calc-afford']=Math.round(afford);}
doc_ready(function(){var m_calc_con=document.querySelector('#mortgage-calc');if(m_calc_con){mortgage_calc(m_calc_con);}
var a_calc_con=document.querySelector('#afford-calc');if(a_calc_con){afford_calc(a_calc_con);}});